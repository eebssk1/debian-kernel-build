--- a/arch/x86/Makefile	2024-05-17 17:28:47.000000000 +0000
+++ b/arch/x86/Makefile	2024-05-30 13:58:33.047538034 +0000
@@ -60,12 +60,6 @@
 # e.g.: obj-y += foo_$(BITS).o
 export BITS
 
-# More compiler optimizations
-ifdef CONFIG_CC_OPTIMIZE_FOR_PERFORMANCE
-KBUILD_CFLAGS += -O3
-KBUILD_RUSTFLAGS += -Copt-level=3
-endif
-
 #
 # Prevent GCC from generating any FP code by mistake.
 #

--- a/Makefile	2024-05-30 13:59:45.965893044 +0000
+++ b/Makefile	2024-05-30 14:00:04.590477704 +0000
@@ -969,8 +969,8 @@
 KBUILD_RUSTFLAGS += $(rustflags64-y)
 
 ifdef CONFIG_CC_OPTIMIZE_FOR_PERFORMANCE
-KBUILD_CFLAGS += -O2
-KBUILD_RUSTFLAGS += -Copt-level=2
+KBUILD_CFLAGS += -O3
+KBUILD_RUSTFLAGS += -Copt-level=3
 else ifdef CONFIG_CC_OPTIMIZE_FOR_SIZE
 KBUILD_CFLAGS += -Os
 KBUILD_RUSTFLAGS += -Copt-level=s
